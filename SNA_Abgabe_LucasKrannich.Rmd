---
title: "SNA_Abgabe_LucasKrannich"
author: "Lucas Krannich"
date: "2025-06-28"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Social Network Analysis - Wikispeedia - Lucas Krannich

Das vorliegende Projekt wurde in einzelarbeit statt in Gruppenarbeit durchgeführt.

Das vorliegende Projekt orientiert sich Grundlegend an dem folgenden Artikel:
https://studentwork.prattsi.org/infovis/labs/exploring-the-network-behind-wikispeedia/

Die Starke orientierung an dem verlinkten Artikel ist unter anderem damit zu begründen, dass der Student eher zu den "fachlich schwächeren" gehört, mit diesem Projekt allerdings eine Herausforderung gesucht wurde, um sich selbst weiter zu entwickeln und weiterzuentwickeln.


## Imports (Data & Libraries)

Libraries importieren

```{r libraries, message=FALSE, warning=FALSE}
library(tidyverse)
library(igraph)
library(ggraph)
library(tidygraph)
```

TSV-Datei einlesen & Info zu Daten ausgeben

```{r read df, message=FALSE, warning=FALSE}
df <- read_tsv("C:/Users/Krann/GitHub/SNA/paths-finished-tsv.tsv", col_names = TRUE)
```

```{r df head}
head(df)
```

## Data Cleaning

Die Daten wurden vor dem Einlesen in R bereits mit Open Refine bereinigt. Die Bereinigung in Open Refine basiert auf der beschreibung des Artikels.
Zeilen, deren Navigationspfade die ein "<" Zeichen enthalten wurden entfernt. ein "<" Zeichen lässt darauf schließen, dass der Spieler zurück auf die Vorherige Wikipedia seite gesprungen ist. In der vorliegenden Analyse sollen nur Pfade betrachtet werden, die direkt von Start- zu Endpunkt durchgeführt wurden, ohne zurück zu gehen. Es soll ein ungerichtetes Netzwerkt dargestellt werden.

Zudem wurden alle Zeilen entfernt, in denen der Spieler maximal 2min gebraucht hat. So können ausreiser vermieden werden und die verbleibenden Datenbasis hat homogene Eigenschaften.

Trotz vorheriger Bereinigung enthält der Datensatz noch "NULL" werte. Diese sind in der Spalte "Rating" wiederzufinden. Allerdings hadelt es sich hierbei nicht um klassische 0 werte, sondern um String werte. Im nächsten Schritt werden alle Zeilen, die einen Null-Wert enthalten, entfernt.
Die Null-Werte werden in R-Entfernt. In Open Refine wäre dies auch möglich gewesen, es wurde sich aber dagegen entschieden, da der Umgang & Die Arbeit mit Open Refine teilweise nicht so intuitiv ist und eine Bereinigung in R schneller geht. Auf eine erneute verwendung von Open Refine würde in zukünftigen Projekten nur zurückgegriffen werden, wenn zuvor bereits alle bereinigungsschritte klar sind, da die verwendung von Open Refine sonst eher umständlich ist.

```{r df filter, message=FALSE }
df <- df %>%
  filter(rating != "NULL")

nrow(df)
```


Der Datensatz wurde von ca. 50.000 Zeilen auf 13.527 Zeilen herunter reduziert.


```{r df head2}
head(df)
```

Alle Null Werte wurden entfernt.
Der Datensatz ist jetzt vollständig bereinigt.

## Vorbereitung Netzwerk Analyse

Im ersten Schritt wird die Funktion Extract Edges erstellt.
Die Navigationspfade aus dem Datensatz werden ausgelesen aufgeteilt und gespeichert. Pfade mit weniger als 2 Werten werden ignoriert. Das liegt daran, dass der Startpunkt somit auch dem Endpunkt wäre.
Anschließend wird eine gerichtete Edgelist erstellt.

```{r edgelist}

extract_edges <- function(path_string) {
  pages <- unlist(strsplit(path_string, ";"))
  if (length(pages) < 2) return(NULL)
  edges <- data.frame(
    source = pages[-length(pages)],
    target = pages[-1]
  )
  return(edges)
}

```

Die Funktion extract_edges wird auf den Datensatz angewandt.
Die Variable edge_list enthält nun die gerichtete Edge List für alle Navigationspfade des Datensatzes.

```{r}
edge_list <- df %>%
  pull(path) %>%
  map_dfr(extract_edges)
```

Die Edge List wird entsprechend der Häufigkeit der einzelnen Pfaden Aggregiert und in der Variable weighted_edges gespeichert. 

```{r}
weighted_edges <- edge_list %>%
  count(source, target, name = "weight")
```

Da das Ziel der Analyse die erstellung eines ungerichteten Graphen ist, wird die "gerichtetheit" der Edge List aufgehoben.

```{r}
g <- graph_from_data_frame(weighted_edges, directed = FALSE)
```

Berechnung von 2 Zentralitätsmaße für alle Knoten im Netzwerk.

Betweenness: Wie oft liegt ein Knoten auf den kürzesten Pfaden zwischen anderen Knoten.
-> Es wrde sich für die Betweenness entschieden, da erkannt werden sollte, welche Knoten eine "Verbinder Rolle" haben (hierfür spricht ein hoher wert)

Degree: Berechnet für jeden Knoten die Anzahl der angrenzenden Kanten.
-> Ein hoher Wert spricht dafür, dass der Knoten eine hohe lokale Konnektivität hat. Da er sich eignet, um populäre Seiten / populären Knoten zu identifizieren, wurde dieser Wert gewählt.

```{r}
V(g)$betweenness <- betweenness(g)
V(g)$degree <- degree(g)
```


Experimentieren Sie mit diesem Schwellenwert (z.B. 10, 20, 50, 100)
Beispiel: Nur Knoten mit mindestens X Verbindungen behalten


```{r}
min_degree_threshold <- 40


g_filtered <- g %>%
  delete_vertices(V(g)$degree < min_degree_threshold) # Knoten mit weniger als X Verbindungen entfernen


cat("Anzahl der Knoten im ursprünglichen Graphen:", vcount(g), "\n")
cat("Anzahl der Knoten im gefilterten Graphen (Degree-Filter):", vcount(g_filtered), "\n")
```


WICHTIG: Wenn Sie Knoten löschen, sollten Betweenness und Degree neu berechnet werden,
da sich die Pfade und Verbindungen im gefilterten Graphen ändern.

```{r}
V(g_filtered)$betweenness <- betweenness(g_filtered)
V(g_filtered)$degree <- degree(g_filtered)

```

# Visualisierung des gefilterten Netzwerks

```{r}
plot_filtered_network <- ggraph(g_filtered, layout = "fr") +
  # Kanten: Breite nach Gewicht, Farbe dunkelgrün
  geom_edge_link(aes(width = weight), alpha = 0.3, color = "darkgreen") + # alpha leicht erhöht
  scale_edge_width(range = c(0.5, 5)) + # Bereich für Kantenbreite angepasst für bessere Sichtbarkeit
  
  # Knoten: Größe nach Betweenness, Farbe nach Degree
  geom_node_point(aes(size = betweenness, color = degree), show.legend = TRUE) +
  scale_size_continuous(range = c(3, 15)) + # Bereich für Knotengröße angepasst für bessere Sichtbarkeit
  scale_color_viridis_c(option = "B", direction = -1) + # Eine bessere Farbskala (viridis)
  geom_node_text(aes(label = name), repel = TRUE, size = 3, max.overlaps = 20) + # Knotenbeschriftungen
  
  theme_void() + # Entfernt Achsen und Hintergrund
  labs(
    title = "Wikispeedia Netzwerkvisualisierung (gefiltert)",
    subtitle = "Größe = Betweenness Centrality | Farbe = Degree | Filter: Degree > 3"
  ) +
  theme(
    legend.position = "right", # Legendenposition anpassen
    plot.title = element_text(hjust = 0.5, face = "bold", size = 16),
    plot.subtitle = element_text(hjust = 0.5, size = 12)
  )
```



```{r}
print(plot_filtered_network)
```

















